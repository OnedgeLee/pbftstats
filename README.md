### 설명

9c-pbft-internal 클러스터에 트랜잭션을 서명하고 있는 공개키들에 대한 집계를 위한 임시 툴입니다.

### 설치

본 프로젝트의 루트 디렉토리에서 아래 명령어를 통하여 `pbftstats`파이썬 패키지를 설치합니다.
```bash
pip install -e .
```

### 사용법

아래의 명령을 통하여 패키지 스크립트를 실행합니다.
```bash
python -m pbftstats.main --out_path=<출력될 디렉토리 경로> --host_url=<쿼리를 보낼 대상 노드의 주소> --start_block_index=<집계를 시작할 블록 인덱스>
```

기본값으로 실행시키시려면 패러미터 없이 아래와 같이 실행하시면 됩니다.
```
python -m pbftstats.main
```

패러미터들의 기본값은 아래와 같습니다.
```
--out_path : ./stat_logs (실행 디렉토리 아래 stat_logs 디렉토리를 생성한 뒤 여기에 저장)
```
```
--host_url : http://a2a14a139dbc243ba9182849af6e2c77-231856034.us-east-2.elb.amazonaws.com (헤들리스의 호스트 주소)
```
```
--start_block_index : 5719259 (1월 3일 정오의 블록 인덱스)
```

일별로 파일이 하나씩 생성되며,
결과로 생성되는 파일명은 `testpbft_YYYY-MM-DD_시작블록_마지막블록_서명자수.csv` 형태이며,
집계가 끝나지 않은 파일(하루가 채 끝나지 않은 파일)은 마지막에 `wip`가 붙습니다.

일일 유저수는 각 파일의 서명자수를 읽어서 확인할 수 있습니다.
ex) testpbft_2023-01-04_005724360_005725586_00054.csv : 2023년 1월 4일간 블록 5724360~5725586가 생성되었으며, 이 블록들에 총 54명이 트랜잭션에 서명하였음

각 파일 안에는 서명자별 서명한 트랜잭션의 수가 작성됩니다.
```csv
signer  txn
03d19d3049620e9582b9de88a693a1bb4e6423abb9d6c619dfd0375bd9fbb8abc9      172
0248e4dbc5d0588f8beccaf93e9aa537b2bca8e235d5ab69ca7ae25a5b99ddc813      9
```
공개키 `03d19...`는 해당일동안 172개의 트랜잭션에 서명하였으며,
공개키 `0248e...`는 해당일동안 9개의 트랜잭션에 서명

작동 중 만약 더 이상 블록이 없을 경우, `IndexError: The block has not been generated yet`을 리턴하며 종료됩니다.

집계일의 기준은 헤들리스 노드에 찍힌 블록의 타임스탬프 기준입니다.